{"version":3,"sources":["ui/browser.ts","utils/formatters.ts","algorithm/charScaling.ts","algorithm/pixelMatrix.ts","algorithm/charDensity.ts","utils/math.ts","algorithm/charPixelMatrix.ts","utils/loaders.ts","data/alphabets.ts","data/defaults.ts","utils/idb.ts","utils/promisify.ts","components/TextArt.tsx","ui/toast.ts","components/Help.tsx","components/ImageUpload.tsx","hooks/useExpandedHitBoxOnDrag.ts","components/NumberInput.tsx","hooks/useRenderToken.ts","hooks/useResponsiveThrottle.ts","hooks/useRefGetter.ts","App.tsx","hooks/useComplexState.ts","algorithm/textArt.ts","index.tsx"],"names":["cssVars","Proxy","document","documentElement","get","o","k","parseFloat","getComputedStyle","getPropertyValue","replace","m","join","toLowerCase","isMobile","navigator","userAgent","includes","getScreenDimensions","window","screen","getBoundingClientRect","width","height","getScreenWidth","appendInvisible","tag","el","createElement","classList","add","setAttribute","body","appendChild","SEPARATOR_REGEX","pre","_getCharScalingData","repeatCount","ch","textContent","repeat","min","Math","aspectRatio","Channels","perceivedLuminance","Red","Green","Blue","getRawCharDensities","charSet","ctx","getContext","charVals","map","canvas","rect","font","clearRect","fillStyle","fillText","val","getImageData","data","reduce","acc","cur","idx","Modulus","Alpha","getRawCharDensity","max","Infinity","exponential","n","cachedLuminanceInfo","getCharPixelMatrix","brightness","contrast","imageLuminanceOptions","length","luminanceInfo","Object","entries","every","key","resolutionX","img","pixelMatrix","flatPixels","scale","x","i","round","w","h","fillRect","drawImage","pixelData","curPix","d","channel","thisPix","push","flat","pix","sort","a","b","getMutableImageLuminanceValues","degree","charPixelMatrix","allCharPixels","multiplier","polynomialFn","pow","charValIdx","charVal","imgCache","Map","readFile","file","Promise","res","reader","FileReader","onload","e","target","result","readAsDataURL","alphabetPresets","name","content","Array","_","String","fromCodePoint","filter","test","default","fileName","src","process","DEFAULTS","alphabet","find","p","invert","dbPromise","openDB","upgrade","db","createObjectStore","idb","set","put","del","delete","clear","keys","getAllKeys","ZoomLevels","sleep","ms","t","setTimeout","toastStyles","success","icon","failure","generic","toast","fromEntries","style","options","msg","div","opacity","transition","Boolean","resolve","requestAnimationFrame","remove","Tooltip","useState","setWidth","updateMaxWidth","useCallback","margin","ref","className","Help","tooltip","visible","setVisible","show","onMouseEnter","onClick","onMouseLeave","role","ImageUpload","handleUpload","fileUploadInputRef","useRef","useEffect","maximizeHitBox","current","revertHitBox","buttons","addEventListener","removeEventListener","handleFileUpload","files","type","split","htmlFor","title","click","id","onChange","tabIndex","alt","TextArt","setScale","drag","setDrag","clickedPoint","Small","zoomLevel","setZoomLevel","dummyEl","setDummyEl","useLayoutEffect","useMemo","naturalWidth","naturalHeight","updateScale","Large","sidebar","sidebarMarginRight","rawScale","undrag","minimize","userSelect","y","scroll","clsx","interactive","clientX","clientY","currentTarget","translate","transform","NumberInput","label","setConfig","configItem","htmlAttrs","RangeError","defaultValue","Number","value","reportValidity","getIdleTime","prevTimeTaken","maxBusyPercentage","useResponsiveThrottle","initialState","state","_setState","latestTime","cancelToken","setState","updateFn","token","cb","start","Date","now","prevState","idleTime","defaultSrc","defaultConfig","App","status","setStatus","setImg","update","Function","useComplexState","config","setSrc","textArt","setTextArt","renderToken","setValue","rerender","v","useRenderToken","darkMode","setDarkMode","all","then","Set","localeCompare","getCharSet","getter","dependencies","useRefGetter","getAlphabetScalingData","rawCharValData","setRawCharValData","range","getNormalizedCharDensities","removeAttribute","cached","crossOrigin","loadImage","setCharPixelMatrix","row","getTextArt","reset","confirm","onSubmit","preventDefault","step","defaultChecked","checked","disabled","select","execCommand","rootElement","getElementById","render"],"mappings":"wNAKaA,EAAU,IAAIC,MAAMC,SAASC,gBAAiB,CAC1DC,IAAK,SAACC,EAAGC,GAAJ,OACJC,WAAWC,iBAAiBH,GAAGI,iBAApB,YAAmDH,ECNlDI,QAAQ,eAAe,SAACC,GAAD,OAAO,YAAIA,GAAGC,KAAK,KAAKC,uBDUhDC,EAAWC,UAAUC,UAAUC,SAAS,QAExCC,EAAsB,WAClC,MAA0BJ,EACvBK,OAAOC,OACPlB,SAASC,gBAAgBkB,wBAE5B,MAAO,CAJP,EAAQC,MAAR,EAAeC,SAOHC,EAAiB,kBAAMN,IAAsB,IAQ7CO,EAAkB,SAC9BC,GAEA,IAAMC,EAAKzB,SAAS0B,cAAcF,GAOlC,OALAC,EAAGE,UAAUC,IAAI,aACjBH,EAAGI,aAAa,cAAe,QAE/B7B,SAAS8B,KAAKC,YAAYN,GAEnBA,GElCFO,EAAkB,6DAIlBC,EAAMV,EAAgB,OAEtBW,EACL,SAACC,GAAD,OACA,SACCC,GAMAH,EAAII,YAAJ,UAAqB,UAAGD,EAAGE,OAAOH,GAAb,MAA8BG,OAAOH,IAE1D,MAA0BF,EAAId,wBAAtBC,EAAR,EAAQA,MAAOC,EAAf,EAAeA,OAETkB,EAAMC,KAAKD,IAAInB,EAAOC,GAI5B,OAFAY,EAAII,YAAc,GAEX,CACNjB,MAAOA,EAAQe,EACfd,OAAQA,EAASc,EACjBM,YAAa,CAACF,EAAMnB,EAAOmB,EAAMlB,MAkB7B,I,ECrCKqB,E,iBAAAA,O,aAAAA,I,iBAAAA,I,eAAAA,I,iBAAAA,I,sBAAAA,M,KAYZ,IAAMC,GAAkB,mBACtBD,EAASE,IAAM,MADO,cAEtBF,EAASG,MAAQ,MAFK,cAGtBH,EAASI,KAAO,MAHM,GCqCXC,EAAsB,SAACC,GACnC,IAD4E,EAGtEC,EAFSjD,SAAS0B,cAAc,UAEnBwB,WAAW,MAExBC,EAAW,YAAIH,GAASI,IArC9B,SAACH,GAAD,OACA,SAACb,GACA,IAAQiB,EAAWJ,EAAXI,OAERA,EAAOhC,OAAS,GAChBgC,EAAOjC,MAAQ,GAEf,IAEMkC,EAAa,CAAC,EAAG,EAFGD,EAAlBjC,MAAkBiC,EAAXhC,QAmBf,OAfA4B,EAAIM,KAAO,iBAEXN,EAAIO,UAAJ,MAAAP,EAAiBK,GAEjBL,EAAIQ,UAAY,OAChBR,EAAIS,SAAStB,EAAI,GAAI,IAUd,CACNA,KACAuB,IAVWV,EACVW,aADU,MAAAX,EACMK,GAChBO,KAAKC,QACL,SAACC,EAAKC,EAAKC,GAAX,OACCA,EAAMvB,EAASwB,UAAYxB,EAASyB,MAAQJ,EAAMC,EAAMD,IACzD,KAc+BK,CAAkBnB,IAEhDoB,GAAOC,IACP/B,EAAM+B,IARkE,cAUtDnB,GAVsD,IAU5E,2BAAgC,CAAC,IAApBQ,EAAmB,QAAnBA,IACZU,EAAM7B,KAAK6B,IAAIA,EAAKV,GACpBpB,EAAMC,KAAKD,IAAIA,EAAKoB,IAZuD,8BAe5E,MAAO,CACNR,WACAZ,MACA8B,QCxEWE,EAAc,SAACC,GAAD,gBAAe,GAAOA,EAAI,GAAK,I,uCCQtDC,EAAsB,GAGbC,EAAqB,SAAC,GAKa,IAJ/CC,EAI8C,EAJ9CA,WACAC,EAG8C,EAH9CA,SACAzB,EAE8C,EAF9CA,SACG0B,EAC2C,iBAC9C,IAAK1B,EAAS2B,OAAQ,MAAO,GAE7B,IAAMC,EAAgBC,OAAOC,QAAQJ,GAAuBK,OAC3D,mCAAEC,EAAF,KAAOxB,EAAP,YACCc,EAAoBU,KACpBxB,KAECc,EHK0C,SAAC,GAIjB,IAH7BW,EAG4B,EAH5BA,YACA3C,EAE4B,EAF5BA,YACA4C,EAC4B,EAD5BA,IAEA,IAAKA,EACJ,MAAO,CACNC,YAAa,GACbC,WAAY,IAId,IAAQnE,EAAkBiE,EAAlBjE,MAAOC,EAAWgE,EAAXhE,OAETmE,EAAQJ,EAAchE,EAE5B,EAAe,CAACA,EAAOC,GAAQ+B,KAAI,SAACqC,EAAGC,GAAJ,OAClClD,KAAKmD,MAAMF,EAAID,EAAQ/C,EAAYiD,OADpC,mBAAOE,EAAP,KAAUC,EAAV,KAIMvC,EAAa,CAAC,EAAG,EAAGsC,EAAGC,GAEvBxC,EAASrD,SAAS0B,cAAc,UAEtC2B,EAAOjC,MAAQwE,EACfvC,EAAOhC,OAASwE,EAEhB,IAAM5C,EAAMI,EAAOH,WAAW,MAE9BD,EAAIQ,UAAY,OAEhBR,EAAI6C,SAAJ,MAAA7C,EAAgBK,GAEhBL,EAAI8C,UAAJ,MAAA9C,EAAG,CAAWoC,GAAX,OAAmB/B,IAEtB,IA/B4B,EA+BtB0C,EAAY/C,EAAIW,aAAJ,MAAAX,EAAoBK,GAAMO,KAExCoC,EAAS,EAEPX,EAAmC,GAErCjB,GAAM,IACN9B,EAAM+B,IAtCkB,cAwCL0B,EAAUf,WAxCL,IAwC5B,2BAA4C,CAAC,IAAD,yBAAhChB,EAAgC,KAA3BiC,EAA2B,KACrCC,EAAWlC,EAAMvB,EAASwB,QAEhC,GAAIiC,IAAYzD,EAASyB,MAExB8B,GAAUC,EAAIvD,EAAmBwD,OAC3B,CAIN,IAAMC,EAAU,CAAEzC,IAAKsC,EAAQ7D,GAAI,IAEnCiC,EAAM7B,KAAK6B,IAAIA,EAAK4B,GACpB1D,EAAMC,KAAKD,IAAIA,EAAK0D,GAEhBhC,GAAO2B,EAAIlD,EAASwB,WAAaxB,EAASyB,MAE7CmB,EAAYe,KAAK,CAACD,IAElBd,EAAYA,EAAYR,OAAS,GAAGuB,KAAKD,GAG1CH,EAAS,IA9DiB,8BAqE5B,IArE4B,EAqEtBV,EAAaD,EAAYgB,OArEH,cAuEVf,GAvEU,IAuE5B,2BAA8B,CAAC,IAApBgB,EAAmB,QAC7BA,EAAI5C,KAAO4C,EAAI5C,IAAMpB,IAAQ8B,EAAM9B,IAxER,8BA+E5B,OAFAgD,EAAWiB,MAAK,SAACC,EAAGC,GAAJ,OAAUD,EAAE9C,IAAM+C,EAAE/C,OAE7B,CACN2B,cACAC,cGzFEoB,CAA+B9B,GAElCJ,EAAmB,2BAAQI,GAA0BE,GAErD,IDpC0B6B,ECuBoB,EAaxCC,EAAkB9B,EAAcO,YAChCwB,EAAgB/B,EAAcQ,WAE9BwB,EAAaxC,EAAYI,GACzBqC,GDxCoBJ,ECwCMrC,EAAYK,GDxCC,SAACa,GAAD,OAC7CA,EAAI,GACDjD,KAAKyE,IAAI,EAAGL,EAAS,GAAKpE,KAAKyE,IAAIxB,EAAGmB,GACtC,EAAIpE,KAAKyE,KAAK,EAAIxB,EAAI,EAAGmB,GAAU,ICuClCM,EAAa,EACbC,EAAUhE,EAAS+D,GApBuB,cAsB5BJ,GAtB4B,IAsB9C,2BAAiC,CAChC,IADiC,IAAD,EAAtBP,EAAsB,QACzBW,EAAa/D,EAAS2B,QAAQ,CAGpC,GAFAqC,EAAUhE,EAAS+D,GAEfF,EAAaT,EAAI5C,KAAOoD,GAAcI,EAAQxD,IAAK,CACtD4C,EAAInE,GAAK+E,EAAQ/E,GACjB,QAEE8E,EAMJX,EAAInE,IAAY,QAAP,EAAA+E,SAAA,eAAS/E,KAAM,KApCqB,8BAyC9C,OAAO,YAAIyE,IChENO,EAAW,IAAIC,IAoBRC,EAAW,SAACC,GAAD,OACvB,IAAIC,SAAgB,SAACC,GACpB,IAAMC,EAAS,IAAIC,WAEnBD,EAAOE,OAAS,SAACC,GAAD,OAAOJ,EAAII,EAAEC,OAAQC,SAErCL,EAAOM,cAAcT,OCoDVU,EAAkB,CAC9B,CAAEC,KAAM,QAASC,QA/EO,YAAI,IAAIC,MAAM,OACrChF,KAAI,SAACiF,EAAG3C,GAAJ,OAAU4C,OAAOC,cAAc7C,MACnC8C,QAAO,SAACpG,GAAD,MAAQ,QAAQqG,KAAKrG,MAC5B1B,KAAK,KA6EN,CAAEwH,KAAM,QAASC,QARF,kCASf,CAAED,KAAM,UAAWC,QARJ,oDASf,CAAED,KAAM,OAAQC,QAZhB,4mCAaA,CAAED,KAAM,eAAgBC,QA9EP,+zPA8E8BO,SAAS,GACxD,CAAER,KAAM,kBAAmBC,QAR3B,6jBAQsDO,SAAS,IClF1DC,EAAW,UACXC,EAAM,CAACC,sBAAwBF,GAAUjI,KAAK,KAGvCoI,EAAW,CACvBH,WACAC,MACAG,SALgBd,EAAgBe,MAAK,SAACC,GAAD,OAAOA,EAAEP,WAAUP,QAMxD/C,YAAa,IACb8D,QAAQ,EACRvE,WAAY,GACZC,SAAU,I,+BCXLuE,EAAYC,YAAO,eAAgB,EAAG,CAC3CC,QAD2C,SACnCC,GACPA,EAAGC,kBAAkB,aAIVC,EAAM,CACZtJ,IADY,SACRiF,GAAc,OAAD,oHACRgE,EADQ,uCACGjJ,IAAI,SAAUiF,IADjB,8CAIjBsE,IALY,SAKRtE,EAAaxB,GAAW,OAAD,oHAClBwF,EADkB,uCACPO,IAAI,SAAU/F,EAAKwB,IADZ,8CAI3BwE,IATY,SASRxE,GAAc,OAAD,oHACRgE,EADQ,uCACGS,OAAO,SAAUzE,IADpB,8CAIjB0E,MAbY,WAaH,OAAD,oHACCV,EADD,uCACYU,MAAM,WADlB,8CAIRC,KAjBY,WAiBJ,OAAD,oHACEX,EADF,uCACaY,WAAW,WADxB,+CAMZ9I,OAAeuI,IAAMA,EC9BhB,ICcFQ,EDdQC,EAAQ,SAACC,GAAD,OACpB,IAAI1C,SAAuC,SAACC,GAC3C,IAAM0C,EAAmCC,YAAW,kBAAM3C,EAAI0C,KAAID,OEO9DG,EAAkD,CACvDC,QAAS,CAAEC,KAAM,UACjBC,QAAS,CAAED,KAAM,UACjBE,QAAS,CAAEF,KAAM,KAmCLG,EAAQ1F,OAAO2F,YAC3B3F,OAAO8E,KAAKO,GAAajH,KAAI,SAACwH,GAAD,MAAW,CACvCA,GA/BAC,EAgCU,CAAED,MAAOA,GAhCpB,uCACA,WAAOE,GAAP,eAAArE,EAAA,6DACOsE,EAAM/K,SAAS0B,cAAc,QAE/BC,UAAUC,IAAI,SAElBmJ,EAAIH,MAAMI,QAAU,IACpBD,EAAIH,MAAMK,WAAa,eAEvBF,EAAI1I,YAAc,CAACgI,EAAYQ,EAAQD,OAAOL,KAAMO,GAClDtC,OAAO0C,SACPxK,KAAK,KAEPV,SAAS8B,KAAKC,YAAYgJ,GAZ3B,SFZA,IAAIvD,SAAgB,SAAC2D,GAAD,OAAaC,sBAAsBD,MEYvD,cAgBCJ,EAAIH,MAAMI,QAAU,IAhBrB,UAkBOf,EAAM,MAlBb,eAoBCc,EAAIH,MAAMK,WAAa,eACvBF,EAAIH,MAAMI,QAAU,IArBrB,UAuBOf,EAAM,KAvBb,QAyBCc,EAAIM,SAzBL,4CADA,4DAACR,M,OCfIS,EAED,SAAC,GAAiB,IAAfnD,EAAc,EAAdA,QACP,EAA0BoD,mBAAS,GAAnC,mBAAOnK,EAAP,KAAcoK,EAAd,KAEMC,EAAiBC,uBAAY,SAACjK,GAC/BA,GACH+J,EACChJ,KAAKD,IACJjB,IACCG,EAAGN,wBAAwBsE,EAC3B3F,EAAQ6L,OACT,QAID,IAEH,OACC,sBACCC,IAAKH,EACLI,UAAU,UACVjB,MAAO,CACNxJ,SAJF,SAOE+G,KAKS2D,EAER,SAAC,GAAiB,IAAfC,EAAc,EAAdA,QACP,EAA8BR,oBAAS,GAAvC,mBAAOS,EAAP,KAAgBC,EAAhB,KAEMC,EAAO,kBAAMD,GAAW,IAG9B,OACC,sBAAMJ,UAAU,cAAhB,SACC,uBACCM,aAAcD,EACdE,QAASF,EACTG,aAPU,kBAAMJ,GAAW,IAQ3BK,KAAK,SACL,aAAW,OALZ,UAOC,sBAAM,iBAAYT,UAAU,OAA5B,eAGCG,GAAW,cAAC,EAAD,CAAS7D,QAAS4D,UC7CrBQ,EAIT,SAAC,GAAqC,ICXzCX,EDWMY,EAAkC,EAAlCA,aAAc7D,EAAoB,EAApBA,SAAUC,EAAU,EAAVA,IACxB6D,EAAqBC,iBAAyB,MCZpDd,EDcwBa,ECZxBE,qBAAU,WAGT,IAAMC,EAAiB,WAAO,IAAD,EAC5B,UAAAhB,EAAIiB,eAAJ,SAAalL,UAAUC,IAAI,gBAGtBkL,EAAe,SAACjF,GAIlB,IAAD,EAFAA,GACa,EAAZA,EAAEkF,SAEJ,UAAAnB,EAAIiB,eAAJ,SAAalL,UAAU0J,OAAO,gBAShC,OALArL,SAASgN,iBAAiB,YAAaJ,GAEvC5M,SAASgN,iBAAiB,YAAaF,GACvC9M,SAASgN,iBAAiB,OAAQF,GAE3B,WACNA,IAEA9M,SAASiN,oBAAoB,YAAaL,GAE1C5M,SAASiN,oBAAoB,YAAaH,GAC1C9M,SAASiN,oBAAoB,OAAQH,MAEpC,CAAClB,IDfJ,IAAMsB,EAAmBxB,sBAAW,uCACnC,WAAO7D,GAAP,iBAAApB,EAAA,yDACOc,EADP,UACcM,EAAEC,OAAOqF,aADvB,aACc,EAAiB,GAD/B,oDAKwC,UAA5B5F,EAAK6F,KAAKC,MAAM,KAAK,GALjC,uBAME3C,EAAMF,QAAQ,8BANhB,sCAWCgC,EAXD,KAYYjF,EAAKW,KAZjB,UAaaZ,EAASC,GAbtB,0BAYEoB,SAZF,KAaEC,IAbF,iEADmC,sDAiBnC,CAAC4D,IAGF,OACC,qBAAKX,UAAU,uBAAf,SACC,qBAAKA,UAAU,cAAf,SACC,wBAAOyB,QAAQ,OAAOC,MAAM,kBAA5B,UACC,gCACC,qBAAK1B,UAAU,QAAf,wBACA,wBACCA,UAAU,MACVuB,KAAK,SAELhB,QAAS,kCAAMK,EAAmBI,eAAzB,aAAM,EAA4BW,SAJ5C,oBAQA,uBACC5B,IAAKa,EACLgB,GAAG,OACHL,KAAK,OACLM,SAAUR,EACVS,UAAW,IAEZ,sBAAM9B,UAAU,YAAhB,SAA6BlD,OAE9B,8BACC,qBAAKkD,UAAU,YAAYjD,IAAKA,EAAKgF,IAAKjF,c,kBHhD3CqB,O,iBAAAA,I,mBAAAA,I,iBAAAA,I,sBAAAA,M,KAUE,IAAM6D,EAER,SAAC,GAAiB,IAAf1F,EAAc,EAAdA,QACP,EAA0BoD,mBAAS,GAAnC,mBAAO/F,EAAP,KAAcsI,EAAd,KACA,EAAwBvC,oBAAS,GAAjC,mBAAOwC,EAAP,KAAaC,EAAb,KACMC,EAAevB,iBAAc,CAAC,EAAG,IAEvC,EAAkCnB,mBAAoBvB,EAAWkE,OAAjE,mBAAOC,EAAP,KAAkBC,EAAlB,KAKA,EAA8B7C,mBAAgC,MAA9D,mBAAO8C,EAAP,KAAgBC,EAAhB,KAEM1C,EAAMc,iBAAuB,MAEnC6B,2BAAgB,WACf,IAAM9M,EAAKF,EAAgB,OAI3B,OAFA+M,EAAW7M,GAEJ,kBAAMA,EAAG4J,YACd,IAEH,MAAsCmD,mBAAQ,WAC7C,IAAKH,EAAS,MAAO,CAAC,EAAG,GAEzBA,EAAQhM,YAAc8F,EAEtB,MAA0BkG,EAAQlN,wBAA1BC,EAAR,EAAQA,MAAOC,EAAf,EAAeA,OAIf,OAFAgN,EAAQhM,YAAc,GAEf,CAACjB,EAAOC,KACb,CAACgN,EAASlG,IAVb,mBAAOsG,EAAP,KAAqBC,EAArB,KAYMC,EAAcjD,uBAAY,WAC/B,GAAIyC,IAAcnE,EAAW4E,MAA7B,CAMA,IAAQjD,EAAwC7L,EAAxC6L,OAAQkD,EAAgC/O,EAAhC+O,QAASC,EAAuBhP,EAAvBgP,mBAQnBC,GANczN,KAEnB6M,IAAcnE,EAAWkE,MACb,EAATvC,EAAakD,EAAUC,EACvB,IAE6CL,EAEjDX,EAAStL,KAAKD,IAAIwM,EAjEF,SAkDfjB,EAAS,KAgBR,CAACW,EAAcN,IAuDlB,OArDAI,2BAAgB,WAKf,OAJAI,IAEA1N,OAAO+L,iBAAiB,SAAU2B,GAE3B,kBAAM1N,OAAOgM,oBAAoB,SAAU0B,MAChD,CAACA,IAEJJ,2BAAgB,WACf,IAAMS,EAAS,kBAAMhB,GAAQ,IACvBD,EAAO,kBAAMC,GAAQ,IACrBiB,EAAW,SAACpH,GACH,WAAVA,EAAE1C,KAAkBiJ,EAAapE,EAAWkE,QAQjD,OALAlO,SAASgN,iBAAiB,YAAagC,GACvChP,SAASgN,iBAAiB,YAAae,GAEvC9M,OAAO+L,iBAAiB,UAAWiC,GAE5B,WACNjP,SAASiN,oBAAoB,YAAa+B,GAC1ChP,SAASiN,oBAAoB,YAAac,GAE1C9M,OAAOgM,oBAAoB,UAAWgC,MAErC,IAEHV,2BAAgB,WAKf,OAJIJ,IAAcnE,EAAWkE,QAC5BlO,SAAS8B,KAAK8I,MAAMsE,WAAa,QAG3B,WACNlP,SAAS8B,KAAK8I,MAAMsE,WAAa,MAEhC,CAACf,IAEJI,2BAAgB,WACf,GAAIJ,IAAcnE,EAAW4E,MAAO,CACnC,kBAAeX,EAAapB,QAA5B,GAAOpH,EAAP,KAAU0J,EAAV,KAEA/E,YAAW,WACV,MAAwBpJ,IAAxB,mBAAOI,EAAP,KAAcC,EAAd,KAEAJ,OAAOmO,OACN3J,EAAIgJ,EAAerN,EAAQ,EAC3B+N,EAAIT,EAAgBrN,EAAS,KAE5B,MAEF,CAAC8M,EAAWO,EAAeD,IAG7B,sBACC5C,UAAWwD,YAAK,CACf,iBAAkBlB,IAAcnE,EAAWkE,MAC3CoB,aAAc1O,GAAYuN,IAAcnE,EAAWkE,MACnD,cAAeC,IAAcnE,EAAWkE,MACxC,aAAcC,IAAcnE,EAAW4E,QALzC,UAQET,IAAcnE,EAAWkE,OACzB,wBACCd,KAAK,SACLhB,QAAS,kBAAMgC,EAAapE,EAAWkE,QACvCrC,UAAU,YACV,aAAW,QAJZ,SAMC,sBAAM,iBAAN,oBAGF,qBACCD,IAAKA,EACLQ,QAAS,SAACvE,GAET,IAAKkG,IAASnN,EAAU,CACvB,IAAQ2O,EAAqB1H,EAArB0H,QAASC,EAAY3H,EAAZ2H,QAEjB,EACC3H,EAAE4H,cAActO,wBADTsE,EAAR,EAAQA,EAAG0J,EAAX,EAAWA,EAAG/N,EAAd,EAAcA,MAAOC,EAArB,EAAqBA,OAGrB4M,EAAapB,QAAU,EACrB0C,EAAU9J,GAAKrE,GACfoO,EAAUL,GAAK9N,GAlIrB+M,GAAa,SAAC3I,GAAD,OAAQA,EAAI,GAAKuE,EAAW9F,aAwIvC2H,UAAW,WACX6D,UAAU,KACV9E,MAAO,CACN+E,UAAU,SAAD,OAAWnK,EAAX,KAETmG,OACCwC,IAAcnE,EAAW4E,MACtB,EADH,YAGKF,EAAgBlJ,EAAQkJ,GAAiB,EAH9C,gBAKKD,EAAejJ,EAAQiJ,GAAgB,EAL5C,QAxBH,SAiCEtG,Q,qCK9KE,SAASyH,EAAT,GAKO,IAJbC,EAIY,EAJZA,MACAC,EAGY,EAHZA,UACAC,EAEY,EAFZA,WACGC,EACS,iBACN/K,EAAUD,OAAOC,QAAQ8K,GAE/B,GAAuB,IAAnB9K,EAAQH,OACX,MAAM,IAAImL,WAAW,qCAEtB,MAA6BhL,EAA7B,yCAAQwI,EAAR,KAAYyC,EAAZ,KAEA,OACC,qCACC,uBAAO5C,QAASG,EAAhB,SAAqBoC,IAErB,+CACCzC,KAAK,UADN,2BAGK4C,GAHL,IAIEvC,KACAyC,kBALF,IAOCxC,SAAU,SAAC7F,GACV,IAAMrD,EAAI2L,OAAOtI,EAAE4H,cAAcW,OAGhCvI,EAAE4H,cAAcW,OAChBvI,EAAE4H,cAAcY,kBAEJP,EAAU,eAAGrC,EAAKjJ,WCzC7B,ICAD8L,EAAc,SAACC,EAAuBC,GAAxB,OACnBhO,KAAK6B,IAAKkM,EAAgBC,EAAqB,IAAMD,EAAe,IAE9D,SAASE,EACfC,GAEuC,IADvCF,EACsC,uDADlB,GAEpB,EAA2BjF,mBAAYmF,GAAvC,mBAAOC,EAAP,KAAcC,EAAd,KAEMC,EAAanE,iBAAO,GACpBoE,EAAcpE,kBAAQ,GAEtBqE,EAA2CrF,uBAChD,SAACsF,GACA,IAAMC,IAAUH,EAAYjE,QAEtBqE,EAAK,WACV,IAAMC,EAAQC,KAAKC,MAEnBT,GAAU,SAACU,GACV,GAAIL,IAAUH,EAAYjE,QACzB,OAAOyE,EAGR,IAAMvJ,EAASiJ,EAASM,GAIxB,OAFAT,EAAWhE,QAAUuE,KAAKC,MAAQF,EAE3BpJ,MAIHwJ,EAAWjB,EAAYO,EAAWhE,QAAS2D,GAE7Ce,EACHnH,WAAW8G,EAAIK,GAGfL,MAGF,CAACV,IAGF,MAAO,CAACG,EAAOI,GC5CT,ICmCMS,EAAiC1I,EAAtCF,IAAoB6I,GAA5B,YAA8C3I,EAA9C,SAIa4I,GAAM,WAClB,MAA4BnG,mBAAiB,WAA7C,mBAAOoG,EAAP,KAAeC,EAAf,KAEA,EAAsBrG,mBAAkC,MAAxD,mBAAOlG,EAAP,KAAYwM,EAAZ,KAEA,EC5C8B,SAC9BnB,GAEA,MAA2BnF,mBAASmF,GAApC,mBAAOC,EAAP,KAAcC,EAAd,KAaA,MAAO,CAACD,EAX+CjF,uBACtD,SAACoG,GACAlB,GAAU,SAACU,GACV,OAAOQ,aAAkBC,SAAlB,2BACCT,GAAcQ,EAAOR,IADtB,2BAECA,GAAcQ,QAGxB,KD+B2BE,CAAgBP,IAA5C,mBAAOQ,EAAP,KAAenC,EAAf,KACA,EAAsBvE,mBAAS,IAA/B,mBAAO3C,EAAP,KAAYsJ,EAAZ,KAEA,EAA8B3G,mBAAS,IAAvC,mBAAO4G,EAAP,KAAgBC,EAAhB,KAEMC,EHjDuB,WAC7B,MAA0B9G,mBAAS,GAAnC,mBAAO6E,EAAP,KAAckC,EAAd,KAEA,OAAO9D,mBACN,iBAAO,CACN4B,QACAmC,SAAU,kBAAMD,GAAS,SAACE,GAAD,OAAOA,EAAI,SAErC,CAACpC,IGyCkBqC,GAEZrN,EACP6M,EADO7M,YAAa8D,EACpB+I,EADoB/I,OAAQH,EAC5BkJ,EAD4BlJ,SAAUJ,EACtCsJ,EADsCtJ,SAAU/D,EAChDqN,EADgDrN,SAAUD,EAC1DsN,EAD0DtN,WAG3D,EAAgC4G,oBAAS,GAAzC,mBAAOmH,EAAP,KAAiBC,EAAjB,KAEAhG,qBAAU,WACTnF,QAAQoL,IAAI,CACXpJ,EAAItJ,IAAI,UAAU2S,MAAK,SAACZ,GACvBnC,EAAU,2BAAK2B,IAAkBQ,OAElCzI,EAAItJ,IAAI,OAAO2S,MAAK,SAACjK,GACpBsJ,EAAOtJ,GAAO4I,QAEbqB,MAAK,kBAAMjB,EAAU,eACtB,CAAC9B,IAEJnD,qBAAU,WACM,WAAXgF,GAEJnI,EAAIC,IAAI,SAAUwI,KAChB,CAACN,EAAQM,IAEZtF,qBAAU,WACM,WAAXgF,GAEJnI,EAAIC,IAAI,MAAOb,KACb,CAAC+I,EAAQ/I,IAEZ,IAAM5F,EAAUwL,mBAAQ,kBjB3DC,SAACzF,GAAD,OACzB,YAAI,IAAI+J,IAAI/J,IACVP,QAAO,SAACpG,GAAD,MAAe,OAAPA,KACfoE,MAAK,SAACC,EAAGC,GAAJ,OAAUD,EAAEsM,cAAcrM,MAC/BhG,KAAK,IiBuDuBsS,CAAWjK,KAAW,CAACA,IAE/CtG,EDjFqB,SAC3BwQ,EACAC,GAEA,MAAgB3H,mBAAS0H,GAAlBtC,EAAP,oBAEM/E,EAAMc,iBAAUiE,GAOtB,OALAhE,qBAAU,WACTf,EAAIiB,QAAUoG,MAEZC,GAEItH,ECoEauH,EACnB,iBACY,WAAXxB,EnBlDI,SAAgC3O,GAIpC,IAAD,gBACgBA,GADhB,IACD,2BAA0B,CAAC,IAAhBZ,EAAe,QACzB,IAAKJ,EAAgByG,KAAKrG,GACzB,OAAOF,EAnCW,IAmCXA,CAAkCE,IAH1C,8BAOD,OAAOF,EAvCa,IAuCbA,CAAkC,KmBwCpCkR,CAAuBpQ,GAASP,YAChC,CAAC,EAAG,KACR,CAACkP,EAAQ3O,IAGV,GACCyN,EAA0C,CACzCtN,SAAU,GACVZ,IAAK,EACL8B,IAAK,IAJP,qBAAOgP,GAAP,MAAuBC,GAAvB,MAOA3G,qBAAU,WACM,WAAXgF,GAEJ2B,IAAkB,kBAAMvQ,EAAoBC,QAC1C,CAAC2O,EAAQ3O,EAASsQ,KAErB,IAAMnQ,GAAWqL,mBAChB,kBjBrBD,SAAC,GAAD,IAAGtF,EAAH,EAAGA,OAAH,OACA,YAAiD,IAA9C/F,EAA6C,EAA7CA,SAAUZ,EAAmC,EAAnCA,IAENgR,EAFyC,EAA9BlP,IAEG9B,GAAO,EAE3B,OAAOY,EACLC,KAAI,YAAkB,IAAfhB,EAAc,EAAdA,GACDoQ,GADe,EAAV7O,IACMpB,GAAOgR,EAExB,MAAO,CACNnR,KACAuB,IAAKuF,EAAS,EAAIsJ,EAAIA,MAGvBhM,MAAK,SAACC,EAAGC,GAAJ,OAAUD,EAAE9C,IAAM+C,EAAE/C,QiBOrB6P,CAA2B,CAAEtK,UAA7BsK,CAAuCH,MAC7C,CAACnK,EAAQmK,KAGV1G,qBAAU,WAMT,OALA3M,SAASC,gBAAgB4B,aACxB,eACA6Q,EAAW,OAAS,SAGd,WACN1S,SAASC,gBAAgBwT,gBAAgB,mBAExC,CAACf,IAEJ,IAAMlG,GAAed,uBACpB,YAAmC,IAAhC/C,EAA+B,EAA/BA,SAAUC,EAAqB,EAArBA,IACZkH,EAAU,CAAEnH,aACZuJ,EAAOtJ,KAER,CAACkH,IAGFnD,qBAAU,Yd9Hc,SAAC/D,GAAD,OACxB,IAAIpB,SAA0B,SAACC,GAC9B,IAAMiM,EAAStM,EAASlH,IAAI0I,GAE5B,GAAI8K,EAAoBjM,EAAIiM,OAA5B,CAEA,IAAMrO,EAAMrF,SAAS0B,cAAc,OAEnC2D,EAAIuC,OAAS,WACZR,EAASqC,IAAIb,EAAKvD,GAElBoC,EAAIpC,IAGLA,EAAIsO,YAAc,YAClBtO,EAAIuD,IAAMA,OcgHVgL,CAAUhL,GAAKiK,KAAKhB,KAClB,CAACjJ,IAEJ,OACC6H,EAAuC,IADxC,qBAAO5J,GAAP,MAAwBgN,GAAxB,MAGAlH,qBAAU,WACM,WAAXgF,GAAwBtM,GAE5BwO,IAAmB,WAIlB,OAFAlB,EAAYzJ,GAELxE,EAAmB,CACzBU,cACAC,MACA5C,YAAaA,EAAYoK,QACzBlI,aACAC,WACAzB,mBAGA,CACFwO,EACAzI,EACAvE,EACAC,EACAzB,GACA0Q,GACApR,EACA2C,EACAC,IAGDkJ,2BACC,kBAAM6D,EElKkB,SAACvL,GAAD,OACzBA,EAAgBzD,KAAI,SAAC0Q,GAAD,OAASA,EAAI1Q,KAAI,SAACqC,GAAD,OAAOA,EAAErD,MAAI1B,KAAK,OAAKA,KAAK,MFiK/CqT,CAAWlN,OAC5B,CAACA,KAGF,IAAMmN,GAAQtI,uBAAY,WACPzK,OAAOgT,QACxB,2CAMDrC,EAAU,WAEVM,EAAOV,GACP1B,EAAU2B,IAEVY,EAAYE,WAEZX,EAAU,aACR,CAAC9B,EAAWuC,IAEf,MAAkB,YAAXV,EACN,kDAEA,8BACC,sBAAK9F,UAAU,QAAf,UACC,uBAAMA,UAAU,WAAWqI,SAAU,SAACrM,GAAD,OAAOA,EAAEsM,kBAA9C,UACC,oDAEA,cAAC,EAAD,CAAmBxL,WAAUC,MAAK4D,kBAElC,qBAAKX,UAAU,WAAf,SACC,cAAC+D,EAAD,CACCC,MAAM,qBACNE,WAAY,CAAE3K,eACd0K,UAAWA,EACXvN,IAAK,GACL8B,IAAK,IACL+P,KAAM,MAIR,sBAAKvI,UAAU,WAAf,UACC,uBAAOyB,QAAQ,SAAf,qCAEA,uBACCG,GAAG,SACHL,KAAK,WACLiH,eAAgBnL,EAChBwE,SAAU,SAAC7F,GACViI,EAAU,CAAE5G,OAAQrB,EAAE4H,cAAc6E,gBAKvC,sBAAKzI,UAAU,WAAf,UACC,uBAAOyB,QAAQ,WAAf,sBAEA,cAAC,EAAD,CACCvB,QAAO,gRAGR,yBACC2B,SAAU,SAAC7F,GACV,IAAQuI,EAAUvI,EAAE4H,cAAZW,MAEJA,GACHN,EAAU,CAAE/G,SAAUqH,KAGxBA,MACCnI,EAAgBe,MACf,SAACC,GAAD,OAAOA,EAAEd,UAAYY,KAEnBA,EACA,GAbL,UAgBC,wBAAeqH,MAAM,GAAGmE,UAAQ,EAAhC,0BAAY,IAIXvP,OAAOC,QAAQgD,GAAiB7E,KAAI,mCAAEhD,EAAF,KAAKoS,EAAL,YACpC,wBAAgBpC,MAAOoC,EAAErK,QAAzB,SACEqK,EAAEtK,MADS9H,SAMf,0BACCqN,GAAG,WACH2C,MAAOrH,EACP2E,SAAU,SAAC7F,GAAD,OACTiI,EAAU,CAAE/G,SAAUlB,EAAE4H,cAAcW,cAKzC,sBAAKvE,UAAU,WAAf,UACC,cAAC+D,EAAD,CACCC,MAAM,aACNE,WAAY,CAAEpL,cACdmL,UAAWA,EACXvN,IAAK,EACL8B,IAAK,IACL+P,KAAM,IAGP,cAACxE,EAAD,CACCC,MAAM,WACNE,WAAY,CAAEnL,YACdkL,UAAWA,EACXvN,IAAK,EACL8B,IAAK,IACL+P,KAAM,OAIR,uBAEA,sBAAKvI,UAAU,wBAAf,UACC,wBACCuB,KAAK,SACLhB,QAAS,WACR,IAAMjC,EAAI5I,EAAgB,YAE1B4I,EAAEiG,MAAQ+B,EAEVhI,EAAEqK,SAEgBxU,SAASyU,YAAY,QAGtC/J,EAAMJ,QAAQ,uBAEdI,EAAMF,QAAQ,kBAGfL,EAAEkB,UAjBJ,2BAuBA,wBAAQ+B,KAAK,SAAShB,QAAS4H,GAA/B,qCAMF,cAAC,EAAD,CAAS7L,QAASgK,QA9HVE,EAAYjC,QGxLlBsE,GAAc1U,SAAS2U,eAAe,QAC5CC,iBAAO,cAAC,GAAD,IAASF,M","file":"static/js/main.c845e3ad.chunk.js","sourcesContent":["import { Dimensions } from '../types/types'\nimport { kebabize } from '../utils/formatters'\n\ntype CssVar = 'margin' | 'controls' | 'sidebar' | 'sidebarMarginRight'\n\nexport const cssVars = new Proxy(document.documentElement, {\n\tget: (o, k: CssVar) =>\n\t\tparseFloat(getComputedStyle(o).getPropertyValue(`--${kebabize(k)}`)),\n}) as any as Record<CssVar, number>\n\n// https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#mobile_tablet_or_desktop\nexport const isMobile = navigator.userAgent.includes('Mobi')\n\nexport const getScreenDimensions = (): Dimensions => {\n\tconst { width, height } = isMobile\n\t\t? window.screen\n\t\t: document.documentElement.getBoundingClientRect()\n\n\treturn [width, height]\n}\n\nexport const getScreenWidth = () => getScreenDimensions()[0]\n\ntype HTMLElementTagNameMap = {\n\tdiv: HTMLDivElement\n\tpre: HTMLPreElement\n\ttextarea: HTMLTextAreaElement\n}\n\nexport const appendInvisible = <T extends keyof HTMLElementTagNameMap>(\n\ttag: T,\n) => {\n\tconst el = document.createElement(tag)\n\n\tel.classList.add('invisible')\n\tel.setAttribute('aria-hidden', 'true')\n\n\tdocument.body.appendChild(el)\n\n\treturn el\n}\n","export const kebabize = (camel: string) => {\n\treturn camel.replace(/[a-z][A-Z]/g, (m) => [...m].join('-').toLowerCase())\n}\n\nexport const camelize = (kebab: string) =>\n\tkebab.replace(/([a-z])-([a-z])/g, (_, p1, p2) => p1 + p2.toUpperCase())\n","import { CharSet } from './charDensity'\nimport { appendInvisible } from '../ui/browser'\nimport { AspectRatio } from '../types/types'\n\n// separators and newlines don't play well with the rendering logic\nconst SEPARATOR_REGEX = /[\\n\\p{Z}]/u\n\nconst REPEAT_COUNT = 100\n\nconst pre = appendInvisible('pre')\n\nconst _getCharScalingData =\n\t(repeatCount: number) =>\n\t(\n\t\tch: string,\n\t): {\n\t\twidth: number\n\t\theight: number\n\t\taspectRatio: AspectRatio\n\t} => {\n\t\tpre.textContent = `${`${ch.repeat(repeatCount)}\\n`.repeat(repeatCount)}`\n\n\t\tconst { width, height } = pre.getBoundingClientRect()\n\n\t\tconst min = Math.min(width, height)\n\n\t\tpre.textContent = ''\n\n\t\treturn {\n\t\t\twidth: width / repeatCount,\n\t\t\theight: height / repeatCount,\n\t\t\taspectRatio: [min / width, min / height],\n\t\t}\n\t}\n\nexport function getAlphabetScalingData(charSet: CharSet): {\n\twidth: number\n\theight: number\n\taspectRatio: AspectRatio\n} {\n\tfor (const ch of charSet) {\n\t\tif (!SEPARATOR_REGEX.test(ch)) {\n\t\t\treturn _getCharScalingData(REPEAT_COUNT)(ch)\n\t\t}\n\t}\n\n\treturn _getCharScalingData(REPEAT_COUNT)(' ')\n}\n\nexport const getAlphabetDimensionConsistency = (charSet: CharSet) => {\n\treturn [...charSet]\n\t\t.map((ch) => ({ ch, ..._getCharScalingData(1)(ch) }))\n\t\t.reduce((obj, { ch, width, height }) => {\n\t\t\tconst dims = [width, height].join(',')\n\n\t\t\tobj[dims] = (obj[dims] || '') + ch\n\n\t\t\treturn obj\n\t\t}, {} as Record<string, string>)\n}\n\n// // for debug usage\n// logPerf('alphabet consistency', () => {\n//     for (const [k, v] of Object.entries(presets)) {\n//         console.info(k, getAlphabetDimensionConsistency(getCharSet( v.content)))\n//     }\n// })()\n","import { AspectRatio, Rect } from '../types/types'\n\nexport type Pixel = { val: number }\nexport type PixelMatrix = Pixel[][]\n\nexport type ImageSource =\n\t| HTMLImageElement\n\t| HTMLVideoElement\n\t| HTMLCanvasElement\n\t| ImageBitmap\n\t| OffscreenCanvas\n\nexport enum Channels {\n\tRed,\n\tGreen,\n\tBlue,\n\tAlpha,\n\n\tModulus,\n}\n\nexport type Channel = Exclude<Channels, Channels.Modulus>\n\n// https://stackoverflow.com/a/596243/\nconst perceivedLuminance = {\n\t[Channels.Red]: 0.299,\n\t[Channels.Green]: 0.587,\n\t[Channels.Blue]: 0.114,\n} as const\n\nexport type ImageLuminanceOptions = {\n\timg: ImageSource | null\n\tresolutionX: number\n\taspectRatio: AspectRatio\n}\n\nexport const getMutableImageLuminanceValues = ({\n\tresolutionX,\n\taspectRatio,\n\timg,\n}: ImageLuminanceOptions) => {\n\tif (!img) {\n\t\treturn {\n\t\t\tpixelMatrix: [],\n\t\t\tflatPixels: [],\n\t\t}\n\t}\n\n\tconst { width, height } = img\n\n\tconst scale = resolutionX / width\n\n\tconst [w, h] = [width, height].map((x, i) =>\n\t\tMath.round(x * scale * aspectRatio[i]),\n\t)\n\n\tconst rect: Rect = [0, 0, w, h]\n\n\tconst canvas = document.createElement('canvas')\n\n\tcanvas.width = w\n\tcanvas.height = h\n\n\tconst ctx = canvas.getContext('2d')!\n\n\tctx.fillStyle = '#fff'\n\n\tctx.fillRect(...rect)\n\n\tctx.drawImage(img, ...rect)\n\n\tconst pixelData = ctx.getImageData(...rect).data\n\n\tlet curPix = 0\n\n\tconst pixelMatrix: { val: number }[][] = []\n\n\tlet max = -Infinity\n\tlet min = Infinity\n\n\tfor (const [idx, d] of pixelData.entries()) {\n\t\tconst channel = (idx % Channels.Modulus) as Channel\n\n\t\tif (channel !== Channels.Alpha) {\n\t\t\t// rgb channel\n\t\t\tcurPix += d * perceivedLuminance[channel]\n\t\t} else {\n\t\t\t// append pixel and reset during alpha channel\n\n\t\t\t// we set `ch` later, on second pass\n\t\t\tconst thisPix = { val: curPix, ch: '' }\n\n\t\t\tmax = Math.max(max, curPix)\n\t\t\tmin = Math.min(min, curPix)\n\n\t\t\tif (idx % (w * Channels.Modulus) === Channels.Alpha) {\n\t\t\t\t// first pixel of line\n\t\t\t\tpixelMatrix.push([thisPix])\n\t\t\t} else {\n\t\t\t\tpixelMatrix[pixelMatrix.length - 1].push(thisPix)\n\t\t\t}\n\n\t\t\tcurPix = 0\n\t\t}\n\t}\n\n\t// one-dimensional form, for ease of sorting and iterating.\n\t// changing individual pixels within this also\n\t// mutates `pixelMatrix`\n\tconst flatPixels = pixelMatrix.flat()\n\n\tfor (const pix of flatPixels) {\n\t\tpix.val = (pix.val - min) / (max - min)\n\t}\n\n\t// sorting allows us to iterate over the pixels\n\t// and charVals simultaneously, in linear time\n\tflatPixels.sort((a, b) => a.val - b.val)\n\n\treturn {\n\t\tpixelMatrix,\n\t\tflatPixels,\n\t}\n}\n","import { Channels } from './pixelMatrix'\nimport { Rect } from '../types/types'\n\nexport type CharVal = {\n\tch: string\n\tval: number\n}\n\nexport type RawCharDensityData = {\n\tcharVals: CharVal[]\n\tmin: number\n\tmax: number\n}\n\ntype CharValsOptions = {\n\tinvert: boolean\n}\n\nexport type CharSet = string & {\n\treadonly CharSet: unique symbol\n}\n\nexport const getCharSet = (alphabet: string) =>\n\t[...new Set(alphabet)]\n\t\t.filter((ch) => ch !== '\\n')\n\t\t.sort((a, b) => a.localeCompare(b))\n\t\t.join('') as CharSet\n\nexport const getRawCharDensity =\n\t(ctx: CanvasRenderingContext2D) =>\n\t(ch: string): CharVal => {\n\t\tconst { canvas } = ctx\n\n\t\tcanvas.height = 70\n\t\tcanvas.width = 70\n\n\t\tconst { width, height } = canvas\n\n\t\tconst rect: Rect = [0, 0, width, height]\n\n\t\tctx.font = '48px monospace'\n\n\t\tctx.clearRect(...rect)\n\n\t\tctx.fillStyle = '#000'\n\t\tctx.fillText(ch, 10, 50)\n\n\t\tconst val = ctx\n\t\t\t.getImageData(...rect)\n\t\t\t.data.reduce(\n\t\t\t\t(acc, cur, idx) =>\n\t\t\t\t\tidx % Channels.Modulus === Channels.Alpha ? acc - cur : acc,\n\t\t\t\t0,\n\t\t\t)\n\n\t\treturn {\n\t\t\tch,\n\t\t\tval,\n\t\t}\n\t}\n\nexport const getRawCharDensities = (charSet: CharSet): RawCharDensityData => {\n\tconst canvas = document.createElement('canvas')\n\n\tconst ctx = canvas.getContext('2d')!\n\n\tconst charVals = [...charSet].map(getRawCharDensity(ctx))\n\n\tlet max = -Infinity\n\tlet min = Infinity\n\n\tfor (const { val } of charVals) {\n\t\tmax = Math.max(max, val)\n\t\tmin = Math.min(min, val)\n\t}\n\n\treturn {\n\t\tcharVals,\n\t\tmin,\n\t\tmax,\n\t}\n}\n\nexport const getNormalizedCharDensities =\n\t({ invert }: CharValsOptions) =>\n\t({ charVals, min, max }: RawCharDensityData) => {\n\t\t// minimum of 1, to prevent dividing by 0\n\t\tconst range = max - min || 1\n\n\t\treturn charVals\n\t\t\t.map(({ ch, val }) => {\n\t\t\t\tconst v = (val - min) / range\n\n\t\t\t\treturn {\n\t\t\t\t\tch,\n\t\t\t\t\tval: invert ? 1 - v : v,\n\t\t\t\t}\n\t\t\t})\n\t\t\t.sort((a, b) => a.val - b.val)\n\t}\n","export const polynomial = (degree: number) => (x: number) =>\n\tx < 0.5\n\t\t? Math.pow(2, degree - 1) * Math.pow(x, degree)\n\t\t: 1 - Math.pow(-2 * x + 2, degree) / 2\n\n// converts numbers in range 0..100 into numbers in range 0.1..10\n// to be suitable for usage as brightness/contrast values\nexport const exponential = (n: number) => 10 ** (n / 50 - 1)\n","import { CharVal } from './charDensity'\nimport { polynomial, exponential } from '../utils/math'\nimport {\n\tgetMutableImageLuminanceValues,\n\tImageLuminanceOptions,\n} from './pixelMatrix'\n\nexport type CharPixelMatrix = CharVal[][]\n\nexport type CharPixelMatrixOptions = {\n\tcharVals: CharVal[]\n\tbrightness: number\n\tcontrast: number\n} & ImageLuminanceOptions\n\nlet cachedLuminanceInfo = {} as ImageLuminanceOptions &\n\tReturnType<typeof getMutableImageLuminanceValues>\n\nexport const getCharPixelMatrix = ({\n\tbrightness,\n\tcontrast,\n\tcharVals,\n\t...imageLuminanceOptions\n}: CharPixelMatrixOptions): CharPixelMatrix => {\n\tif (!charVals.length) return []\n\n\tconst luminanceInfo = Object.entries(imageLuminanceOptions).every(\n\t\t([key, val]) =>\n\t\t\tcachedLuminanceInfo[key as keyof typeof imageLuminanceOptions] ===\n\t\t\tval,\n\t)\n\t\t? cachedLuminanceInfo\n\t\t: getMutableImageLuminanceValues(imageLuminanceOptions)\n\n\tcachedLuminanceInfo = { ...imageLuminanceOptions, ...luminanceInfo }\n\n\tconst charPixelMatrix = luminanceInfo.pixelMatrix as CharVal[][]\n\tconst allCharPixels = luminanceInfo.flatPixels as CharVal[]\n\n\tconst multiplier = exponential(brightness)\n\tconst polynomialFn = polynomial(exponential(contrast))\n\n\tlet charValIdx = 0\n\tlet charVal = charVals[charValIdx]\n\n\tfor (const pix of allCharPixels) {\n\t\twhile (charValIdx < charVals.length) {\n\t\t\tcharVal = charVals[charValIdx]\n\n\t\t\tif (polynomialFn(pix.val) * multiplier <= charVal.val) {\n\t\t\t\tpix.ch = charVal.ch\n\t\t\t\tbreak\n\t\t\t} else {\n\t\t\t\t++charValIdx\n\t\t\t}\n\t\t}\n\n\t\t// if none matched so far, we simply use the\n\t\t// last (lightest) character\n\t\tpix.ch = charVal?.ch || ' '\n\t}\n\n\t// cloning the array updates the reference to let React know it needs to re-render,\n\t// even though individual rows and cells are still the same mutated ones\n\treturn [...charPixelMatrix]\n}\n","const imgCache = new Map<string, HTMLImageElement>()\n\nexport const loadImage = (src: string) =>\n\tnew Promise<HTMLImageElement>((res) => {\n\t\tconst cached = imgCache.get(src)\n\n\t\tif (cached) return void res(cached)\n\n\t\tconst img = document.createElement('img')\n\n\t\timg.onload = () => {\n\t\t\timgCache.set(src, img)\n\n\t\t\tres(img)\n\t\t}\n\n\t\timg.crossOrigin = 'anonymous'\n\t\timg.src = src\n\t})\n\nexport const readFile = (file: File) =>\n\tnew Promise<string>((res) => {\n\t\tconst reader = new FileReader()\n\n\t\treader.onload = (e) => res(e.target!.result as string)\n\n\t\treader.readAsDataURL(file)\n\t})\n","const PRINTABLE_ASCIIS = [...new Array(0x1_000)]\n\t.map((_, i) => String.fromCodePoint(i))\n\t.filter((ch) => /[ -~]/.test(ch))\n\t.join('')\n\nconst QIAN_ZI_JING = `天地玄黃，宇宙洪荒。　日月盈昃，辰宿列張。\n寒來暑往，秋收冬藏。　閏餘成歲，律呂調陽。\n雲騰致雨，露結為霜。　金生麗水，玉出崑崗。\n劍號巨闕，珠稱夜光。　果珍李柰，菜重芥薑。\n海鹹河淡，鱗潛羽翔。　龍師火帝，鳥官人皇。\n始制文字，乃服衣裳。　推位讓國，有虞陶唐。\n弔民伐罪，周發殷湯。　坐朝問道，垂拱平章。\n愛育黎首，臣伏戎羌。　遐邇壹體，率賓歸王。\n鳴鳳在樹，白駒食場。　化被草木，賴及萬方。\n蓋此身髮，四大五常。　恭惟鞠養，豈敢毀傷。\n女慕貞絜，男效才良。　知過必改，得能莫忘。\n罔談彼短，靡恃己長。　信使可覆，器欲難量。\n墨悲絲染，詩讚羔羊。　景行維賢，剋念作聖。\n德建名立，形端表正。　空谷傳聲，虛堂習聽。\n禍因惡積，福緣善慶。　尺璧非寶，寸陰是競。\n資父事君，曰嚴與敬。　孝當竭力，忠則盡命。\n臨深履薄，夙興溫凊。　似蘭斯馨，如松之盛。\n川流不息，淵澄取映。　容止若思，言辭安定。\n篤初誠美，慎終宜令。　榮業所基，藉甚無竟。\n學優登仕，攝職從政。　存以甘棠，去而益詠。\n樂殊貴賤，禮別尊卑。　上和下睦，夫唱婦隨。\n外受傅訓，入奉母儀。　諸姑伯叔，猶子比兒。\n孔懷兄弟，同氣連枝。　交友投分，切磨箴規。\n仁慈隱惻，造次弗離。　節義廉退，顛沛匪虧。\n性靜情逸，心動神疲。　守真志滿，逐物意移。\n堅持雅操，好爵自縻。　都邑華夏，東西二京。\n背邙面洛，浮渭據涇。　宮殿盤鬱，樓觀飛驚。\n圖寫禽獸，畫綵仙靈。　丙舍傍啟，甲帳對楹。\n肆筵設席，鼓瑟吹笙。　升階納陛，弁轉疑星。\n右通廣內，左達承明。　既集墳典，亦聚群英。\n杜稿鍾隸，漆書壁經。　府羅將相，路俠槐卿。\n戶封八縣，家給千兵。　高冠陪輦，驅轂振纓。\n世祿侈富，車駕肥輕。　策功茂實，勒碑刻銘。\n磻溪伊尹，佐時阿衡。　奄宅曲阜，微旦孰營。\n桓公匡合，濟弱扶傾。　綺迴漢惠，說感武丁。\n俊乂密勿，多士寔寧。　晉楚更霸，趙魏困橫。\n假途滅虢，踐土會盟。　何遵約法，韓弊煩刑。\n起翦頗牧，用軍最精。　宣威沙漠，馳譽丹青。\n九州禹跡，百郡秦并。　嶽宗恒岱，禪主云亭。\n雁門紫塞，雞田赤城。　昆池碣石，鉅野洞庭。\n曠遠綿邈，巖岫杳冥。　治本於農，務茲稼穡。\n俶載南畝，我藝黍稷。　稅熟貢新，勸賞黜陟。\n孟軻敦素，史魚秉直。　庶幾中庸，勞謙謹敕。\n聆音察理，鑒貌辨色。　貽厥嘉猷，勉其祗植。\n省躬譏誡，寵增抗極。　殆辱近恥，林皋幸即。\n兩疏見機，解組誰逼。　索居閒處，沉默寂寥。\n求古尋論，散慮逍遙。　欣奏累遣，慼謝歡招。\n渠荷的歷，園莽抽條。　枇杷晚翠，梧桐早凋。\n陳根委翳，落葉飄颻。　遊鵾獨運，凌摩絳霄。\n耽讀翫市，寓目囊箱。　易輶攸畏，屬耳垣牆。\n具膳餐飯，適口充腸。　飽飫烹宰，飢厭糟糠。\n親戚故舊，老少異糧。　妾御績紡，侍巾帷房。\n紈扇圓潔，銀燭煒煌。　晝眠夕寐，藍筍象床。\n弦歌酒宴，接杯舉觴。　矯手頓足，悅豫且康。\n嫡後嗣續，祭祀烝嘗。　稽顙再拜，悚懼恐惶。\n牋牒簡要，顧答審詳。　骸垢想浴，執熱願涼。\n驢騾犢特，駭躍超驤。　誅斬賊盜，捕獲叛亡。\n布射遼丸，嵇琴阮嘯。　恬筆倫紙，鈞巧任釣。\n釋紛利俗，並皆佳妙。　毛施淑姿，工顰妍笑。\n年矢每催，曦暉朗曜。　璇璣懸斡，晦魄環照。\n指薪修祜，永綏吉劭。　矩步引領，俯仰廊廟。\n束帶矜莊，徘徊瞻眺。　孤陋寡聞，愚蒙等誚。\n謂語助者，焉哉乎也。`\n\nconst KANAS =\n\t'　ぁあぃいぅうぇえぉおかがきぎくぐけげこごさざしじすずせぜそぞただちぢっつづてでとどなにぬねのはばぱひびぴふぶぷへべぺほぼぽまみむめもゃやゅゆょよらりるれろゎわゐゑをんゔゕ゛゜ゝゞゟ゠ァアィイゥウェエォオカガキギクグケゲコゴサザシジスズセゼソゾタダチヂッツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモャヤュユョヨラリルレロヮワヰヱヲンヴヵヶヷヸヹヺ・ーヽヾヿゖ'\n\nconst BLOCK_1 = '▂▃▅▆▇'\nconst BLOCK_2 = '▀▄█▌▐░▒▓'\n\nconst FULLWIDTH_ASCIIS =\n\t'　！＂＃＄％＆＇（）＊＋，－．／０１２３４５６７８９：；＜＝＞？＠ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ［＼］＾＿｀ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ｛｜｝～'\n\nexport const alphabetPresets = [\n\t{ name: 'ASCII', content: PRINTABLE_ASCIIS },\n\t{ name: 'Block', content: BLOCK_1 },\n\t{ name: 'Block 2', content: BLOCK_2 },\n\t{ name: 'Kana', content: KANAS },\n\t{ name: 'Qian Zi Jing', content: QIAN_ZI_JING, default: true },\n\t{ name: 'Fullwidth ASCII', content: FULLWIDTH_ASCIIS, default: true },\n]\n","import { alphabetPresets } from './alphabets'\n\nconst fileName = 'eye.jpg'\nconst src = [process.env.PUBLIC_URL, fileName].join('/')\nconst alphabet = alphabetPresets.find((p) => p.default)!.content\n\nexport const DEFAULTS = {\n\tfileName,\n\tsrc,\n\talphabet,\n\tresolutionX: 200,\n\tinvert: false,\n\tbrightness: 50,\n\tcontrast: 50,\n}\n","import { openDB } from 'idb'\n\nconst dbPromise = openDB('keyval-store', 1, {\n\tupgrade(db) {\n\t\tdb.createObjectStore('keyval')\n\t},\n})\n\nexport const idb = {\n\tasync get(key: string) {\n\t\treturn (await dbPromise).get('keyval', key)\n\t},\n\n\tasync set(key: string, val: any) {\n\t\treturn (await dbPromise).put('keyval', val, key)\n\t},\n\n\tasync del(key: string) {\n\t\treturn (await dbPromise).delete('keyval', key)\n\t},\n\n\tasync clear() {\n\t\treturn (await dbPromise).clear('keyval')\n\t},\n\n\tasync keys() {\n\t\treturn (await dbPromise).getAllKeys('keyval')\n\t},\n}\n\n// for debug purposes\n;(window as any).idb = idb\n","// promisified setTimeout\nexport const sleep = (ms: number) =>\n\tnew Promise<ReturnType<typeof setTimeout>>((res) => {\n\t\tconst t: ReturnType<typeof setTimeout> = setTimeout(() => res(t), ms)\n\t})\n\n// promisified requestAnimationFrame\nexport const nextAnimationFrame = () =>\n\tnew Promise<number>((resolve) => requestAnimationFrame(resolve))\n","import clsx from 'clsx'\nimport {\n\tFC,\n\tuseCallback,\n\tuseLayoutEffect,\n\tuseMemo,\n\tuseRef,\n\tuseState,\n} from 'react'\nimport { cssVars, appendInvisible } from '../ui/browser'\nimport { Point } from '../types/types'\nimport { getScreenDimensions, getScreenWidth, isMobile } from '../ui/browser'\n\nconst MAX_SCALE = 1\n\nenum ZoomLevels {\n\tSmall,\n\tMedium,\n\tLarge,\n\n\tModulus,\n}\n\ntype ZoomLevel = Exclude<ZoomLevels, ZoomLevels.Modulus>\n\nexport const TextArt: FC<{\n\tcontent: string\n}> = ({ content }) => {\n\tconst [scale, setScale] = useState(1)\n\tconst [drag, setDrag] = useState(false)\n\tconst clickedPoint = useRef<Point>([0, 0])\n\n\tconst [zoomLevel, setZoomLevel] = useState<ZoomLevel>(ZoomLevels.Small)\n\n\tconst incrementZoomLevel = () =>\n\t\tsetZoomLevel((x) => (x + 1) % ZoomLevels.Modulus)\n\n\tconst [dummyEl, setDummyEl] = useState<HTMLPreElement | null>(null)\n\n\tconst ref = useRef<HTMLPreElement>(null)\n\n\tuseLayoutEffect(() => {\n\t\tconst el = appendInvisible('pre')\n\n\t\tsetDummyEl(el)\n\n\t\treturn () => el.remove()\n\t}, [])\n\n\tconst [naturalWidth, naturalHeight] = useMemo(() => {\n\t\tif (!dummyEl) return [0, 0]\n\n\t\tdummyEl.textContent = content\n\n\t\tconst { width, height } = dummyEl.getBoundingClientRect()\n\n\t\tdummyEl.textContent = ''\n\n\t\treturn [width, height]\n\t}, [dummyEl, content])\n\n\tconst updateScale = useCallback(() => {\n\t\tif (zoomLevel === ZoomLevels.Large) {\n\t\t\tsetScale(1)\n\n\t\t\treturn\n\t\t}\n\n\t\tconst { margin, sidebar, sidebarMarginRight } = cssVars\n\n\t\tconst screenWidth = getScreenWidth()\n\t\tconst negativeSpace =\n\t\t\tzoomLevel === ZoomLevels.Small\n\t\t\t\t? margin * 2 + sidebar + sidebarMarginRight\n\t\t\t\t: 0\n\n\t\tconst rawScale = (screenWidth - negativeSpace) / naturalWidth\n\n\t\tsetScale(Math.min(rawScale, MAX_SCALE))\n\t}, [naturalWidth, zoomLevel])\n\n\tuseLayoutEffect(() => {\n\t\tupdateScale()\n\n\t\twindow.addEventListener('resize', updateScale)\n\n\t\treturn () => window.removeEventListener('resize', updateScale)\n\t}, [updateScale])\n\n\tuseLayoutEffect(() => {\n\t\tconst undrag = () => setDrag(false)\n\t\tconst drag = () => setDrag(true)\n\t\tconst minimize = (e: KeyboardEvent) => {\n\t\t\tif (e.key === 'Escape') setZoomLevel(ZoomLevels.Small)\n\t\t}\n\n\t\tdocument.addEventListener('mousedown', undrag)\n\t\tdocument.addEventListener('mousemove', drag)\n\n\t\twindow.addEventListener('keydown', minimize)\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('mousedown', undrag)\n\t\t\tdocument.removeEventListener('mousemove', drag)\n\n\t\t\twindow.removeEventListener('keydown', minimize)\n\t\t}\n\t}, [])\n\n\tuseLayoutEffect(() => {\n\t\tif (zoomLevel !== ZoomLevels.Small) {\n\t\t\tdocument.body.style.userSelect = 'none'\n\t\t}\n\n\t\treturn () => {\n\t\t\tdocument.body.style.userSelect = ''\n\t\t}\n\t}, [zoomLevel])\n\n\tuseLayoutEffect(() => {\n\t\tif (zoomLevel === ZoomLevels.Large) {\n\t\t\tconst [x, y] = clickedPoint.current\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst [width, height] = getScreenDimensions()\n\n\t\t\t\twindow.scroll(\n\t\t\t\t\tx * naturalWidth - width / 2,\n\t\t\t\t\ty * naturalHeight - height / 2,\n\t\t\t\t)\n\t\t\t}, 0)\n\t\t}\n\t}, [zoomLevel, naturalHeight, naturalWidth])\n\n\treturn (\n\t\t<div\n\t\t\tclassName={clsx({\n\t\t\t\t'center-content': zoomLevel === ZoomLevels.Small,\n\t\t\t\tinteractive: !isMobile && zoomLevel === ZoomLevels.Small,\n\t\t\t\t'zoom-medium': zoomLevel !== ZoomLevels.Small,\n\t\t\t\t'zoom-large': zoomLevel === ZoomLevels.Large,\n\t\t\t})}\n\t\t>\n\t\t\t{zoomLevel !== ZoomLevels.Small && (\n\t\t\t\t<button\n\t\t\t\t\ttype='button'\n\t\t\t\t\tonClick={() => setZoomLevel(ZoomLevels.Small)}\n\t\t\t\t\tclassName='close-btn'\n\t\t\t\t\taria-label='Close'\n\t\t\t\t>\n\t\t\t\t\t<span aria-hidden>×</span>\n\t\t\t\t</button>\n\t\t\t)}\n\t\t\t<pre\n\t\t\t\tref={ref}\n\t\t\t\tonClick={(e) => {\n\t\t\t\t\t// useless on mobile as pinch-to-zoom is available\n\t\t\t\t\tif (!drag && !isMobile) {\n\t\t\t\t\t\tconst { clientX, clientY } = e\n\n\t\t\t\t\t\tconst { x, y, width, height } =\n\t\t\t\t\t\t\te.currentTarget.getBoundingClientRect()\n\n\t\t\t\t\t\tclickedPoint.current = [\n\t\t\t\t\t\t\t(clientX - x) / width,\n\t\t\t\t\t\t\t(clientY - y) / height,\n\t\t\t\t\t\t]\n\n\t\t\t\t\t\tincrementZoomLevel()\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tclassName={'text-art'}\n\t\t\t\ttranslate='no'\n\t\t\t\tstyle={{\n\t\t\t\t\ttransform: `scale(${scale})`,\n\t\t\t\t\t// https://medium.com/@sai_prasanna/simulating-css-zoom-with-css3-transform-scale-461d1b9762d6\n\t\t\t\t\tmargin:\n\t\t\t\t\t\tzoomLevel === ZoomLevels.Large\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: `${\n\t\t\t\t\t\t\t\t\t-(naturalHeight - scale * naturalHeight) / 2\n\t\t\t\t\t\t\t  }px ${\n\t\t\t\t\t\t\t\t\t-(naturalWidth - scale * naturalWidth) / 2\n\t\t\t\t\t\t\t  }px `,\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{content}\n\t\t\t</pre>\n\t\t</div>\n\t)\n}\n","import { nextAnimationFrame, sleep } from '../utils/promisify'\n\ntype ToastStyle = 'success' | 'failure' | 'generic'\n\ntype ToastOptions = {\n\tstyle: ToastStyle\n}\n\ntype ToastStyleInfo = { icon: string }\n\nconst toastStyles: Record<ToastStyle, ToastStyleInfo> = {\n\tsuccess: { icon: '✅' },\n\tfailure: { icon: '❌' },\n\tgeneric: { icon: '' },\n}\n\ntype FireToastFn = (msg: string) => void\n\nconst fireToast =\n\t(options: ToastOptions): FireToastFn =>\n\tasync (msg) => {\n\t\tconst div = document.createElement('div')\n\n\t\tdiv.classList.add('toast')\n\n\t\tdiv.style.opacity = '0'\n\t\tdiv.style.transition = 'opacity 0.6s'\n\n\t\tdiv.textContent = [toastStyles[options.style].icon, msg]\n\t\t\t.filter(Boolean)\n\t\t\t.join(' ')\n\n\t\tdocument.body.appendChild(div)\n\n\t\tawait nextAnimationFrame()\n\n\t\tdiv.style.opacity = '1'\n\n\t\tawait sleep(2600)\n\n\t\tdiv.style.transition = 'opacity 0.8s'\n\t\tdiv.style.opacity = '0'\n\n\t\tawait sleep(800)\n\n\t\tdiv.remove()\n\t}\n\nexport const toast = Object.fromEntries(\n\tObject.keys(toastStyles).map((style) => [\n\t\tstyle,\n\t\tfireToast({ style: style as ToastStyle }),\n\t]),\n) as Record<ToastStyle, FireToastFn>\n","import { FC, useState, useCallback } from 'react'\nimport { getScreenWidth } from '../ui/browser'\nimport { cssVars } from '../ui/browser'\n\nconst Tooltip: FC<{\n\tcontent: string\n}> = ({ content }) => {\n\tconst [width, setWidth] = useState(0)\n\n\tconst updateMaxWidth = useCallback((el: HTMLSpanElement) => {\n\t\tif (el) {\n\t\t\tsetWidth(\n\t\t\t\tMath.min(\n\t\t\t\t\tgetScreenWidth() -\n\t\t\t\t\t\tel.getBoundingClientRect().x -\n\t\t\t\t\t\tcssVars.margin,\n\t\t\t\t\t400,\n\t\t\t\t),\n\t\t\t)\n\t\t}\n\t}, [])\n\n\treturn (\n\t\t<span\n\t\t\tref={updateMaxWidth}\n\t\t\tclassName='tooltip'\n\t\t\tstyle={{\n\t\t\t\twidth,\n\t\t\t}}\n\t\t>\n\t\t\t{content}\n\t\t</span>\n\t)\n}\n\nexport const Help: FC<{\n\ttooltip: string\n}> = ({ tooltip }) => {\n\tconst [visible, setVisible] = useState(false)\n\n\tconst show = () => setVisible(true)\n\tconst hide = () => setVisible(false)\n\n\treturn (\n\t\t<span className='help-parent'>\n\t\t\t<span\n\t\t\t\tonMouseEnter={show}\n\t\t\t\tonClick={show}\n\t\t\t\tonMouseLeave={hide}\n\t\t\t\trole='button'\n\t\t\t\taria-label='Help'\n\t\t\t>\n\t\t\t\t<span aria-hidden className='help'>\n\t\t\t\t\t?\n\t\t\t\t</span>\n\t\t\t\t{visible && <Tooltip content={tooltip}></Tooltip>}\n\t\t\t</span>\n\t\t</span>\n\t)\n}\n","import { ChangeEvent, FC, useCallback, useRef } from 'react'\nimport { toast } from '../ui/toast'\nimport { readFile } from '../utils/loaders'\nimport { useExpandedHitBoxOnDrag } from '../hooks/useExpandedHitBoxOnDrag'\n\nexport type FileAttrs = {\n\tfileName: string\n\tsrc: string\n}\n\nexport const ImageUpload: FC<\n\tFileAttrs & {\n\t\thandleUpload: (fileAttrs: FileAttrs) => void\n\t}\n> = ({ handleUpload, fileName, src }) => {\n\tconst fileUploadInputRef = useRef<HTMLInputElement>(null)\n\n\tuseExpandedHitBoxOnDrag(fileUploadInputRef)\n\n\tconst handleFileUpload = useCallback(\n\t\tasync (e: ChangeEvent<HTMLInputElement>) => {\n\t\t\tconst file = e.target.files?.[0]\n\n\t\t\tif (!file) {\n\t\t\t\treturn\n\t\t\t} else if (file.type.split('/')[0] !== 'image') {\n\t\t\t\ttoast.failure('Must be an image file type')\n\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\thandleUpload({\n\t\t\t\tfileName: file.name,\n\t\t\t\tsrc: await readFile(file),\n\t\t\t})\n\t\t},\n\t\t[handleUpload],\n\t)\n\n\treturn (\n\t\t<div className='form-row file-upload'>\n\t\t\t<div className='interactive'>\n\t\t\t\t<label htmlFor='file' title='Upload an image'>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div className='label'>Image file</div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName='btn'\n\t\t\t\t\t\t\ttype='button'\n\t\t\t\t\t\t\t// captures click-like keyboard events (space, enter, etc.)\n\t\t\t\t\t\t\tonClick={() => fileUploadInputRef.current?.click()}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tUpload\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref={fileUploadInputRef}\n\t\t\t\t\t\t\tid='file'\n\t\t\t\t\t\t\ttype='file'\n\t\t\t\t\t\t\tonChange={handleFileUpload}\n\t\t\t\t\t\t\ttabIndex={-1}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span className='file-name'>{fileName}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<img className='thumbnail' src={src} alt={fileName} />\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n","import { MutableRefObject, useEffect } from 'react'\n\nexport const useExpandedHitBoxOnDrag = (\n\tref: MutableRefObject<HTMLInputElement | null>,\n) => {\n\tuseEffect(() => {\n\t\t// expand hit box of image upload element to cover whole screen\n\t\t// on drag and drop, thus intercepting all drop events\n\t\tconst maximizeHitBox = () => {\n\t\t\tref.current?.classList.add('max-hit-box')\n\t\t}\n\n\t\tconst revertHitBox = (e?: MouseEvent) => {\n\t\t\tif (\n\t\t\t\t!e || // called directly\n\t\t\t\t!(e.buttons & 1) // not dragging (`1` is left-click)\n\t\t\t) {\n\t\t\t\tref.current?.classList.remove('max-hit-box')\n\t\t\t}\n\t\t}\n\n\t\tdocument.addEventListener('dragenter', maximizeHitBox)\n\n\t\tdocument.addEventListener('mousemove', revertHitBox)\n\t\tdocument.addEventListener('drop', revertHitBox)\n\n\t\treturn () => {\n\t\t\trevertHitBox()\n\n\t\t\tdocument.removeEventListener('dragenter', maximizeHitBox)\n\n\t\t\tdocument.removeEventListener('mousemove', revertHitBox)\n\t\t\tdocument.removeEventListener('drop', revertHitBox)\n\t\t}\n\t}, [ref])\n}\n","import { Dispatch, SetStateAction } from 'react'\nimport { Config } from '../App'\n\ntype Props<T extends keyof Config> = {\n\tconfigItem: Record<T, number>\n\tmin: number\n\tmax: number\n\tstep: number\n\tlabel: string\n\tsetConfig: Dispatch<SetStateAction<Partial<Config>>>\n}\n\nexport function NumberInput<T extends keyof Config>({\n\tlabel,\n\tsetConfig,\n\tconfigItem,\n\t...htmlAttrs\n}: Props<T>) {\n\tconst entries = Object.entries(configItem)\n\n\tif (entries.length !== 1)\n\t\tthrow new RangeError('config item must be a single item')\n\n\tconst [[id, defaultValue]] = entries as [[T, number]]\n\n\treturn (\n\t\t<>\n\t\t\t<label htmlFor={id}>{label}</label>\n\n\t\t\t<input\n\t\t\t\ttype='number'\n\t\t\t\t{...{\n\t\t\t\t\t...htmlAttrs,\n\t\t\t\t\tid,\n\t\t\t\t\tdefaultValue,\n\t\t\t\t}}\n\t\t\t\tonChange={(e) => {\n\t\t\t\t\tconst n = Number(e.currentTarget.value)\n\n\t\t\t\t\tconst isValid =\n\t\t\t\t\t\te.currentTarget.value &&\n\t\t\t\t\t\te.currentTarget.reportValidity()\n\n\t\t\t\t\tif (isValid) setConfig({ [id]: n })\n\t\t\t\t}}\n\t\t\t/>\n\t\t</>\n\t)\n}\n","import { useMemo, useState } from 'react'\n\nexport const useRenderToken = () => {\n\tconst [value, setValue] = useState(0)\n\n\treturn useMemo(\n\t\t() => ({\n\t\t\tvalue,\n\t\t\trerender: () => setValue((v) => v + 1),\n\t\t}),\n\t\t[value],\n\t)\n}\n","import { Dispatch, useCallback, useRef, useState } from 'react'\n\nconst getIdleTime = (prevTimeTaken: number, maxBusyPercentage: number) =>\n\tMath.max((prevTimeTaken / maxBusyPercentage) * 100 - prevTimeTaken, 0)\n\nexport function useResponsiveThrottle<T>(\n\tinitialState: T | (() => T),\n\tmaxBusyPercentage = 50,\n): [T, Dispatch<(prevState?: T) => T>] {\n\tconst [state, _setState] = useState<T>(initialState)\n\n\tconst latestTime = useRef(0)\n\tconst cancelToken = useRef(-1)\n\n\tconst setState: Dispatch<(prevState?: T) => T> = useCallback(\n\t\t(updateFn) => {\n\t\t\tconst token = ++cancelToken.current\n\n\t\t\tconst cb = () => {\n\t\t\t\tconst start = Date.now()\n\n\t\t\t\t_setState((prevState) => {\n\t\t\t\t\tif (token !== cancelToken.current) {\n\t\t\t\t\t\treturn prevState\n\t\t\t\t\t}\n\n\t\t\t\t\tconst result = updateFn(prevState)\n\n\t\t\t\t\tlatestTime.current = Date.now() - start\n\n\t\t\t\t\treturn result\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tconst idleTime = getIdleTime(latestTime.current, maxBusyPercentage)\n\n\t\t\tif (idleTime) {\n\t\t\t\tsetTimeout(cb, idleTime)\n\t\t\t} else {\n\t\t\t\t// update state synchronously\n\t\t\t\tcb()\n\t\t\t}\n\t\t},\n\t\t[maxBusyPercentage],\n\t)\n\n\treturn [state, setState]\n}\n","import { MutableRefObject, useEffect, useRef, useState } from 'react'\n\nexport const useRefGetter = <T>(\n\tgetter: () => T,\n\tdependencies: any[],\n): MutableRefObject<T> => {\n\tconst [state] = useState(getter)\n\n\tconst ref = useRef<T>(state)\n\n\tuseEffect(() => {\n\t\tref.current = getter()\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, dependencies)\n\n\treturn ref\n}\n","import {\n\tuseCallback,\n\tuseEffect,\n\tuseLayoutEffect,\n\tuseMemo,\n\tuseState,\n} from 'react'\nimport { getAlphabetScalingData } from './algorithm/charScaling'\nimport {\n\tgetNormalizedCharDensities,\n\tgetRawCharDensities,\n\tgetCharSet,\n\tRawCharDensityData,\n} from './algorithm/charDensity'\nimport {\n\tgetCharPixelMatrix,\n\tCharPixelMatrix,\n} from './algorithm/charPixelMatrix'\nimport { getTextArt } from './algorithm/textArt'\nimport { loadImage } from './utils/loaders'\nimport { DEFAULTS } from './data/defaults'\nimport { alphabetPresets } from './data/alphabets'\nimport { idb } from './utils/idb'\nimport { appendInvisible } from './ui/browser'\nimport { toast } from './ui/toast'\nimport { Help } from './components/Help'\nimport { FileAttrs, ImageUpload } from './components/ImageUpload'\nimport { TextArt } from './components/TextArt'\nimport { NumberInput } from './components/NumberInput'\nimport { useRenderToken } from './hooks/useRenderToken'\nimport { useComplexState } from './hooks/useComplexState'\nimport { useResponsiveThrottle } from './hooks/useResponsiveThrottle'\nimport { AspectRatio } from './types/types'\nimport { useRefGetter } from './hooks/useRefGetter'\n\nexport type Status = 'loading' | 'error' | 'loaded'\n\nconst { src: defaultSrc, ...defaultConfig } = DEFAULTS\n\nexport type Config = typeof defaultConfig\n\nexport const App = () => {\n\tconst [status, setStatus] = useState<Status>('loading')\n\n\tconst [img, setImg] = useState<null | HTMLImageElement>(null)\n\n\tconst [config, setConfig] = useComplexState(defaultConfig)\n\tconst [src, setSrc] = useState('')\n\n\tconst [textArt, setTextArt] = useState('')\n\n\tconst renderToken = useRenderToken()\n\n\tconst { resolutionX, invert, alphabet, fileName, contrast, brightness } =\n\t\tconfig\n\n\tconst [darkMode, setDarkMode] = useState(false)\n\n\tuseEffect(() => {\n\t\tPromise.all([\n\t\t\tidb.get('config').then((config) => {\n\t\t\t\tsetConfig({ ...defaultConfig, ...config })\n\t\t\t}),\n\t\t\tidb.get('src').then((src) => {\n\t\t\t\tsetSrc(src || defaultSrc)\n\t\t\t}),\n\t\t]).then(() => setStatus('loaded'))\n\t}, [setConfig])\n\n\tuseEffect(() => {\n\t\tif (status !== 'loaded') return\n\n\t\tidb.set('config', config)\n\t}, [status, config])\n\n\tuseEffect(() => {\n\t\tif (status !== 'loaded') return\n\n\t\tidb.set('src', src)\n\t}, [status, src])\n\n\tconst charSet = useMemo(() => getCharSet(alphabet), [alphabet])\n\n\tconst aspectRatio = useRefGetter<AspectRatio>(\n\t\t() =>\n\t\t\tstatus === 'loaded'\n\t\t\t\t? getAlphabetScalingData(charSet).aspectRatio\n\t\t\t\t: [1, 1],\n\t\t[status, charSet],\n\t)\n\n\tconst [rawCharValData, setRawCharValData] =\n\t\tuseResponsiveThrottle<RawCharDensityData>({\n\t\t\tcharVals: [],\n\t\t\tmin: 0,\n\t\t\tmax: 0,\n\t\t})\n\n\tuseEffect(() => {\n\t\tif (status !== 'loaded') return\n\n\t\tsetRawCharValData(() => getRawCharDensities(charSet))\n\t}, [status, charSet, setRawCharValData])\n\n\tconst charVals = useMemo(\n\t\t() => getNormalizedCharDensities({ invert })(rawCharValData),\n\t\t[invert, rawCharValData],\n\t)\n\n\tuseEffect(() => {\n\t\tdocument.documentElement.setAttribute(\n\t\t\t'color-scheme',\n\t\t\tdarkMode ? 'dark' : 'light',\n\t\t)\n\n\t\treturn () => {\n\t\t\tdocument.documentElement.removeAttribute('color-scheme')\n\t\t}\n\t}, [darkMode])\n\n\tconst handleUpload = useCallback(\n\t\t({ fileName, src }: FileAttrs) => {\n\t\t\tsetConfig({ fileName })\n\t\t\tsetSrc(src)\n\t\t},\n\t\t[setConfig],\n\t)\n\n\tuseEffect(() => {\n\t\tloadImage(src).then(setImg)\n\t}, [src])\n\n\tconst [charPixelMatrix, setCharPixelMatrix] =\n\t\tuseResponsiveThrottle<CharPixelMatrix>([])\n\n\tuseEffect(() => {\n\t\tif (status !== 'loaded' || !img) return\n\n\t\tsetCharPixelMatrix(() => {\n\t\t\t// only after throttled callback to prevent jank\n\t\t\tsetDarkMode(invert)\n\n\t\t\treturn getCharPixelMatrix({\n\t\t\t\tresolutionX,\n\t\t\t\timg,\n\t\t\t\taspectRatio: aspectRatio.current,\n\t\t\t\tbrightness,\n\t\t\t\tcontrast,\n\t\t\t\tcharVals,\n\t\t\t})\n\t\t})\n\t}, [\n\t\tstatus,\n\t\tinvert,\n\t\tbrightness,\n\t\tcontrast,\n\t\tcharVals,\n\t\tsetCharPixelMatrix,\n\t\taspectRatio,\n\t\tresolutionX,\n\t\timg,\n\t])\n\n\tuseLayoutEffect(\n\t\t() => setTextArt(getTextArt(charPixelMatrix)),\n\t\t[charPixelMatrix],\n\t)\n\n\tconst reset = useCallback(() => {\n\t\tconst confirmed = window.confirm(\n\t\t\t'Reset image and settings to defaults?',\n\t\t)\n\n\t\tif (!confirmed) return\n\n\t\t// reduce jank\n\t\tsetStatus('loading')\n\n\t\tsetSrc(defaultSrc)\n\t\tsetConfig(defaultConfig)\n\n\t\trenderToken.rerender()\n\n\t\tsetStatus('loaded')\n\t}, [setConfig, renderToken])\n\n\treturn status === 'loading' ? (\n\t\t<>Loading...</>\n\t) : (\n\t\t<div key={renderToken.value}>\n\t\t\t<div className='panes'>\n\t\t\t\t<form className='controls' onSubmit={(e) => e.preventDefault()}>\n\t\t\t\t\t<h1>Text Art Generator</h1>\n\n\t\t\t\t\t<ImageUpload {...{ fileName, src, handleUpload }} />\n\n\t\t\t\t\t<div className='form-row'>\n\t\t\t\t\t\t<NumberInput\n\t\t\t\t\t\t\tlabel='Width (characters)'\n\t\t\t\t\t\t\tconfigItem={{ resolutionX }}\n\t\t\t\t\t\t\tsetConfig={setConfig}\n\t\t\t\t\t\t\tmin={10}\n\t\t\t\t\t\t\tmax={300}\n\t\t\t\t\t\t\tstep={1}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className='form-row'>\n\t\t\t\t\t\t<label htmlFor='invert'>Invert (light on dark)?</label>\n\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid='invert'\n\t\t\t\t\t\t\ttype='checkbox'\n\t\t\t\t\t\t\tdefaultChecked={invert}\n\t\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\t\tsetConfig({ invert: e.currentTarget.checked })\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className='form-row'>\n\t\t\t\t\t\t<label htmlFor='alphabet'>Alphabet</label>\n\n\t\t\t\t\t\t<Help\n\t\t\t\t\t\t\ttooltip={`Choose one of the presets or roll your own.\\n\\nFor best results, make sure to use characters that are all the same width when displayed in a monospace font. For example, \"ABCabc\" is fine, and so is \"一二三四五\", but \"abc一二三\" isn't.`}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\t\tconst { value } = e.currentTarget\n\n\t\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t\tsetConfig({ alphabet: value })\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tvalue={\n\t\t\t\t\t\t\t\talphabetPresets.find(\n\t\t\t\t\t\t\t\t\t(p) => p.content === alphabet,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t? alphabet\n\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option key='' value='' disabled>\n\t\t\t\t\t\t\t\t-- Presets --\n\t\t\t\t\t\t\t</option>\n\n\t\t\t\t\t\t\t{Object.entries(alphabetPresets).map(([k, v]) => (\n\t\t\t\t\t\t\t\t<option key={k} value={v.content}>\n\t\t\t\t\t\t\t\t\t{v.name}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</select>\n\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tid='alphabet'\n\t\t\t\t\t\t\tvalue={alphabet}\n\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\tsetConfig({ alphabet: e.currentTarget.value })\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className='form-row'>\n\t\t\t\t\t\t<NumberInput\n\t\t\t\t\t\t\tlabel='Brightness'\n\t\t\t\t\t\t\tconfigItem={{ brightness }}\n\t\t\t\t\t\t\tsetConfig={setConfig}\n\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\tmax={100}\n\t\t\t\t\t\t\tstep={1}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<NumberInput\n\t\t\t\t\t\t\tlabel='Contrast'\n\t\t\t\t\t\t\tconfigItem={{ contrast }}\n\t\t\t\t\t\t\tsetConfig={setConfig}\n\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\tmax={100}\n\t\t\t\t\t\t\tstep={1}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<hr />\n\n\t\t\t\t\t<div className='form-row form-buttoms'>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype='button'\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tconst t = appendInvisible('textarea')\n\n\t\t\t\t\t\t\t\tt.value = textArt\n\n\t\t\t\t\t\t\t\tt.select()\n\n\t\t\t\t\t\t\t\tconst succeeded = document.execCommand('copy')\n\n\t\t\t\t\t\t\t\tif (succeeded) {\n\t\t\t\t\t\t\t\t\ttoast.success('Copied to clipboard')\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttoast.failure('Failed to copy')\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tt.remove()\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCopy text art\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<button type='button' onClick={reset}>\n\t\t\t\t\t\t\tReset to defaults\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\n\t\t\t\t<TextArt content={textArt} />\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n","import { Dispatch, SetStateAction, useCallback, useState } from 'react'\n\nexport const useComplexState = <T>(\n\tinitialState: T | (() => T),\n): [T, Dispatch<SetStateAction<Partial<T>>>] => {\n\tconst [state, _setState] = useState(initialState)\n\n\tconst setState: Dispatch<SetStateAction<Partial<T>>> = useCallback(\n\t\t(update) => {\n\t\t\t_setState((prevState) => {\n\t\t\t\treturn update instanceof Function\n\t\t\t\t\t? { ...prevState, ...update(prevState) }\n\t\t\t\t\t: { ...prevState, ...update }\n\t\t\t})\n\t\t},\n\t\t[],\n\t)\n\n\treturn [state, setState]\n}\n","import { CharPixelMatrix } from './charPixelMatrix'\n\nexport const getTextArt = (charPixelMatrix: CharPixelMatrix) =>\n\tcharPixelMatrix.map((row) => row.map((x) => x.ch).join('')).join('\\n')\n","import './styles/styles.css'\nimport { render } from 'react-dom'\n\nimport { App } from './App'\n\nconst rootElement = document.getElementById('root')\nrender(<App />, rootElement)\n"],"sourceRoot":""}